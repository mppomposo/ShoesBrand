name: 01 fact sale order shopify

on:
  schedule:
    # Horario de VERANO (marzo a octubre): 12:50 y 21:50 UTC
    - cron: '50 12,21 * 3-10 *'
    # Horario de INVIERNO (noviembre a febrero): 13:50 y 22:50 UTC
    - cron: '50 13,22 * 11-2 *'

  workflow_dispatch:  # Permite ejecuci√≥n manual

jobs:
  etl:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Instalar dependencias
      run: |
        pip install -r etl/requirements.txt
    
    - name: Ejecutar ETL
      env:
        SHOP_NAME: ${{ secrets.SHOP_NAME }}
        ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
        API_VERSION: ${{ secrets.API_VERSION }}
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        
      run: python etl/01_FACT_SALES_ORDER_SHOPIFY.py
